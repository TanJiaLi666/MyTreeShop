<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tulingxueyuan.mall.modules.pms.mapper.PmsProductCategoryMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.tulingxueyuan.mall.modules.pms.model.PmsProductCategory">
        <id column="id" property="id" />
        <result column="parent_id" property="parentId" />
        <result column="name" property="name" />
        <result column="level" property="level" />
        <result column="product_count" property="productCount" />
        <result column="product_unit" property="productUnit" />
        <result column="nav_status" property="navStatus" />
        <result column="show_status" property="showStatus" />
        <result column="sort" property="sort" />
        <result column="icon" property="icon" />
        <result column="keywords" property="keywords" />
        <result column="description" property="description" />
        <result column="enable" property="enable" />
    </resultMap>
    <resultMap id="productDTO" type="com.tulingxueyuan.mall.modules.pms.model.dto.HomeCateDTO">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <collection property="productList" columnPrefix="product_" ofType="com.tulingxueyuan.mall.modules.pms.model.dto.ProductDTO">
            <result property="id" column="id"/>
            <result property="name" column="name"/>
            <result property="pic" column="pic"/>
            <result property="price" column="price"/>
            <result property="promotionPrice" column="promotionPrice"/>
            <result property="originalPrice" column="originalPrice"/>
            <result property="subTitle" column="subTitle"/>
        </collection>
    </resultMap>

    <select id="getCateList" resultMap="productDTO">
        SELECT
            pc.`id`,
            pc.`name`,
            p.`id` product_id,
            p.`name` product_name,
            p.`pic` product_pic,
            p.`price` product_price,
            p.`promotion_price` product_promotionPrice,
            p.`original_price` product_originalPrice,
            p.`sub_title` subTitle
        FROM
            `pms_product_category` pc
        LEFT JOIN
            `pms_product` p ON  EXISTS(SELECT pc2.`id` FROM `pms_product_category` pc2 WHERE pc2.`parent_id`= pc.`id` AND p.`product_category_id`=pc2.`id`)AND p.`delete_status` = 0 AND p.`recommand_status`= 1
        WHERE
            pc.`parent_id` = 0 AND pc.`nav_status` = 1
        ORDER BY
            pc.`sort`,
            pc.`id`
    </select>

</mapper>
